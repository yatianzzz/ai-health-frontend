# NFT获得条件逻辑测试说明

## 更新后的NFT获得条件

### 1. 折扣权益NFT（7R和30R系列）
这些NFT基于 **运动记录 + 饮食记录** 的总数来判断：

- **7R5percent（7条记录5%折扣卡）**: 需要 7条记录（运动+饮食）
- **7R10percent（7条记录10%折扣卡）**: 需要 7条记录（运动+饮食）  
- **30R8percent（30条记录8%折扣卡）**: 需要 30条记录（运动+饮食）
- **30R10percent（30条记录10%折扣卡）**: 需要 30条记录（运动+饮食）

### 2. 成就证书NFT
这些NFT基于特定类型的记录来判断：

- **regularDiet（饮食之王）**: 需要 30条饮食记录
- **PowerKing（运动之王）**: 需要 30条运动记录

## 测试步骤

### 步骤1: 查看当前记录状态
1. 登录系统
2. 导航到 "NFT Incentive" 页面
3. 连接钱包
4. 查看控制台输出，应该显示：
   ```
   用户活动记录: X 条
   用户饮食记录: Y 条
   ```

### 步骤2: 测试折扣卡NFT
1. 查看7R和30R系列NFT的进度显示
2. 应该显示类似：`5/7 条记录已完成（运动3+饮食2）`
3. 当运动+饮食记录总数 ≥ 要求数量时，"立即获得"按钮应该变为可点击状态

### 步骤3: 测试成就证书NFT
1. 查看"饮食之王"NFT：
   - 进度应显示：`Y/30 条饮食记录已完成`
   - 只有饮食记录数 ≥ 30时才能获得
2. 查看"运动之王"NFT：
   - 进度应显示：`X/30 条运动记录已完成`
   - 只有运动记录数 ≥ 30时才能获得

### 步骤4: 验证控制台调试信息
打开浏览器开发者工具，在控制台中应该看到详细的检查日志：

```javascript
// 折扣卡检查示例
"7R5percent 折扣卡检查: 需要7条记录，运动3条+饮食4条=总计7条"

// 成就证书检查示例  
"饮食之王检查: 需要30条饮食记录，当前有15条"
"运动之王检查: 需要30条运动记录，当前有8条"
```

## API调用说明

系统现在会同时调用两个API：
1. `GET /api/user-activities` - 获取运动记录
2. `GET /api/dietary-records` - 获取饮食记录

确保后端这两个接口都能正常返回数据。

## 预期行为

### 场景1: 用户有5条运动记录，3条饮食记录
- 总记录数: 8条
- **7R系列NFT**: ✅ 可获得（8 ≥ 7）
- **30R系列NFT**: ❌ 不可获得（8 < 30）
- **饮食之王**: ❌ 不可获得（3 < 30）
- **运动之王**: ❌ 不可获得（5 < 30）

### 场景2: 用户有15条运动记录，35条饮食记录
- 总记录数: 50条
- **7R系列NFT**: ✅ 可获得（50 ≥ 7）
- **30R系列NFT**: ✅ 可获得（50 ≥ 30）
- **饮食之王**: ✅ 可获得（35 ≥ 30）
- **运动之王**: ❌ 不可获得（15 < 30）

### 场景3: 用户有35条运动记录，15条饮食记录
- 总记录数: 50条
- **7R系列NFT**: ✅ 可获得（50 ≥ 7）
- **30R系列NFT**: ✅ 可获得（50 ≥ 30）
- **饮食之王**: ❌ 不可获得（15 < 30）
- **运动之王**: ✅ 可获得（35 ≥ 30）

## 故障排除

如果NFT获得条件不正确，检查：

1. **后端API是否正常**：确保两个接口都能返回正确数据
2. **认证token**：确保用户已正确登录
3. **控制台错误**：查看是否有API调用失败的错误信息
4. **数据格式**：确保API返回的数据格式符合接口定义

## 代码更改总结

### 主要修改的文件
- `frontend/src/services/nftService.ts`

### 新增功能
1. `getUserDietaryRecords()` 方法：获取用户饮食记录
2. 增强的 `checkNFTEligibility()` 方法：支持不同NFT类型的判断逻辑
3. 改进的 `getAllNFTsWithOwnership()` 方法：显示详细的进度信息

### 接口定义
```typescript
export interface DietaryRecord {
    id: number;
    userId: number;
    recordDate: string;
    recordTime: any;
    mealType: string;
    notes: string;
    totalCalories: number;
    createTime?: string;
}
``` 