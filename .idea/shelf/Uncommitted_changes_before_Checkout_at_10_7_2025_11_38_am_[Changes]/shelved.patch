Index: package.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{\r\n  \"name\": \"health-management-system\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"dependencies\": {\r\n    \"@ant-design/charts\": \"^2.2.7\",\r\n    \"@ant-design/icons\": \"^6.0.0\",\r\n    \"@react-three/drei\": \"^9.122.0\",\r\n    \"@react-three/fiber\": \"^8.18.0\",\r\n    \"@testing-library/dom\": \"^10.4.0\",\r\n    \"@testing-library/jest-dom\": \"^6.6.3\",\r\n    \"@testing-library/react\": \"^14.2.1\",\r\n    \"@testing-library/user-event\": \"^13.5.0\",\r\n    \"@types/dompurify\": \"^3.0.5\",\r\n    \"@types/jest\": \"^27.5.2\",\r\n    \"@types/node\": \"^16.18.126\",\r\n    \"@types/react\": \"^18.2.45\",\r\n    \"@types/react-dom\": \"^18.2.18\",\r\n    \"@types/three\": \"^0.150.2\",\r\n    \"antd\": \"^5.26.0\",\r\n    \"axios\": \"^1.10.0\",\r\n    \"dompurify\": \"^3.2.5\",\r\n    \"react\": \"^18.2.0\",\r\n    \"react-dom\": \"^18.2.0\",\r\n    \"react-router-dom\": \"^6.22.0\",\r\n    \"react-scripts\": \"5.0.1\",\r\n    \"styled-components\": \"^6.1.17\",\r\n    \"three\": \"^0.150.1\",\r\n    \"typescript\": \"^4.9.5\",\r\n    \"web-vitals\": \"^2.1.4\"\r\n  },\r\n  \"scripts\": {\r\n    \"start\": \"react-scripts start\",\r\n    \"build\": \"react-scripts build\",\r\n    \"test\": \"react-scripts test\",\r\n    \"eject\": \"react-scripts eject\"\r\n  },\r\n  \"eslintConfig\": {\r\n    \"extends\": [\r\n      \"react-app\",\r\n      \"react-app/jest\"\r\n    ]\r\n  },\r\n  \"browserslist\": {\r\n    \"production\": [\r\n      \">0.2%\",\r\n      \"not dead\",\r\n      \"not op_mini all\"\r\n    ],\r\n    \"development\": [\r\n      \"last 1 chrome version\",\r\n      \"last 1 firefox version\",\r\n      \"last 1 safari version\"\r\n    ]\r\n  }\r\n}\r\n
===================================================================
diff --git a/package.json b/package.json
--- a/package.json	(revision 387f7fe72766336a5b3041ce9afc53a8e728d617)
+++ b/package.json	(date 1752076618691)
@@ -16,7 +16,6 @@
     "@types/node": "^16.18.126",
     "@types/react": "^18.2.45",
     "@types/react-dom": "^18.2.18",
-    "@types/three": "^0.150.2",
     "antd": "^5.26.0",
     "axios": "^1.10.0",
     "dompurify": "^3.2.5",
@@ -25,7 +24,7 @@
     "react-router-dom": "^6.22.0",
     "react-scripts": "5.0.1",
     "styled-components": "^6.1.17",
-    "three": "^0.150.1",
+    "three": "^0.178.0",
     "typescript": "^4.9.5",
     "web-vitals": "^2.1.4"
   },
@@ -52,5 +51,8 @@
       "last 1 firefox version",
       "last 1 safari version"
     ]
+  },
+  "devDependencies": {
+    "@types/three": "^0.178.0"
   }
 }
Index: package-lock.json
===================================================================
diff --git a/package-lock.json b/package-lock.json
--- a/package-lock.json	(revision 387f7fe72766336a5b3041ce9afc53a8e728d617)
+++ b/package-lock.json	(date 1752076633176)
@@ -21,7 +21,6 @@
         "@types/node": "^16.18.126",
         "@types/react": "^18.2.45",
         "@types/react-dom": "^18.2.18",
-        "@types/three": "^0.150.2",
         "antd": "^5.26.0",
         "axios": "^1.10.0",
         "dompurify": "^3.2.5",
@@ -30,9 +29,12 @@
         "react-router-dom": "^6.22.0",
         "react-scripts": "5.0.1",
         "styled-components": "^6.1.17",
-        "three": "^0.150.1",
+        "three": "^0.178.0",
         "typescript": "^4.9.5",
         "web-vitals": "^2.1.4"
+      },
+      "devDependencies": {
+        "@types/three": "^0.178.0"
       }
     },
     "node_modules/@adobe/css-tools": {
@@ -3008,6 +3010,12 @@
         "postcss-selector-parser": "^6.0.10"
       }
     },
+    "node_modules/@dimforge/rapier3d-compat": {
+      "version": "0.12.0",
+      "resolved": "https://registry.npmjs.org/@dimforge/rapier3d-compat/-/rapier3d-compat-0.12.0.tgz",
+      "integrity": "sha512-uekIGetywIgopfD97oDL5PfeezkFpNhwlzlaEYNOA0N6ghdsOvh/HYjSMek5Q2O1PYvRSDFcqFVJl4r4ZBwOow==",
+      "license": "Apache-2.0"
+    },
     "node_modules/@emotion/hash": {
       "version": "0.8.0",
       "resolved": "https://registry.npmjs.org/@emotion/hash/-/hash-0.8.0.tgz",
@@ -4749,6 +4757,12 @@
         "node": ">=10.13.0"
       }
     },
+    "node_modules/@tweenjs/tween.js": {
+      "version": "23.1.3",
+      "resolved": "https://registry.npmjs.org/@tweenjs/tween.js/-/tween.js-23.1.3.tgz",
+      "integrity": "sha512-vJmvvwFxYuGnF2axRtPYocag6Clbb5YS7kLL+SO/TeVFzHqDIWrNKYtcsPMibjDx9O+bu+psAy9NKfWklassUA==",
+      "license": "MIT"
+    },
     "node_modules/@types/aria-query": {
       "version": "5.0.4",
       "resolved": "https://registry.npmjs.org/@types/aria-query/-/aria-query-5.0.4.tgz",
@@ -5286,16 +5300,25 @@
       "license": "MIT"
     },
     "node_modules/@types/three": {
-      "version": "0.150.2",
-      "resolved": "https://registry.npmjs.org/@types/three/-/three-0.150.2.tgz",
-      "integrity": "sha512-cvcz/81Mmj4oiAA+uxzwaRK3t8lYw8WxejXKqIBfu6PqvwSAEEiCi3VfCiVY18UflBqL0LDX/za85+sfqjMoIw==",
+      "version": "0.178.0",
+      "resolved": "https://registry.npmjs.org/@types/three/-/three-0.178.0.tgz",
+      "integrity": "sha512-1IpVbMKbEAAWjyn0VTdVcNvI1h1NlTv3CcnwMr3NNBv/gi3PL0/EsWROnXUEkXBxl94MH5bZvS8h0WnBRmR/pQ==",
       "license": "MIT",
       "dependencies": {
+        "@dimforge/rapier3d-compat": "~0.12.0",
+        "@tweenjs/tween.js": "~23.1.3",
         "@types/stats.js": "*",
         "@types/webxr": "*",
-        "fflate": "~0.6.9",
-        "lil-gui": "~0.17.0"
+        "@webgpu/types": "*",
+        "fflate": "~0.8.2",
+        "meshoptimizer": "~0.18.1"
       }
+    },
+    "node_modules/@types/three/node_modules/fflate": {
+      "version": "0.8.2",
+      "resolved": "https://registry.npmjs.org/fflate/-/fflate-0.8.2.tgz",
+      "integrity": "sha512-cPJU47OaAoCbg0pBvzsgpTPhmhqI5eJjh/JIu8tPj5q+T7iLvW/JAYUqmE7KOB4R1ZyEhzBaIQpQpardBF5z8A==",
+      "license": "MIT"
     },
     "node_modules/@types/trusted-types": {
       "version": "2.0.7",
@@ -5732,6 +5755,12 @@
         "@xtuc/long": "4.2.2"
       }
     },
+    "node_modules/@webgpu/types": {
+      "version": "0.1.64",
+      "resolved": "https://registry.npmjs.org/@webgpu/types/-/types-0.1.64.tgz",
+      "integrity": "sha512-84kRIAGV46LJTlJZWxShiOrNL30A+9KokD7RB3dRCIqODFjodS5tCD5yyiZ8kIReGVZSDfA3XkkwyyOIF6K62A==",
+      "license": "BSD-3-Clause"
+    },
     "node_modules/@xtuc/ieee754": {
       "version": "1.2.0",
       "resolved": "https://registry.npmjs.org/@xtuc/ieee754/-/ieee754-1.2.0.tgz",
@@ -13595,12 +13624,6 @@
         "immediate": "~3.0.5"
       }
     },
-    "node_modules/lil-gui": {
-      "version": "0.17.0",
-      "resolved": "https://registry.npmjs.org/lil-gui/-/lil-gui-0.17.0.tgz",
-      "integrity": "sha512-MVBHmgY+uEbmJNApAaPbtvNh1RCAeMnKym82SBjtp5rODTYKWtM+MXHCifLe2H2Ti1HuBGBtK/5SyG4ShQ3pUQ==",
-      "license": "MIT"
-    },
     "node_modules/lilconfig": {
       "version": "2.1.0",
       "resolved": "https://registry.npmjs.org/lilconfig/-/lilconfig-2.1.0.tgz",
@@ -13856,6 +13879,12 @@
         "three": ">=0.137"
       }
     },
+    "node_modules/meshoptimizer": {
+      "version": "0.18.1",
+      "resolved": "https://registry.npmjs.org/meshoptimizer/-/meshoptimizer-0.18.1.tgz",
+      "integrity": "sha512-ZhoIoL7TNV4s5B6+rx5mC//fw8/POGyNxS/DZyCJeiZ12ScLfVwRE/GfsxwiTkMYYD5DmK2/JXnEVXqL4rF+Sw==",
+      "license": "MIT"
+    },
     "node_modules/methods": {
       "version": "1.1.2",
       "resolved": "https://registry.npmjs.org/methods/-/methods-1.1.2.tgz",
@@ -19677,9 +19706,9 @@
       }
     },
     "node_modules/three": {
-      "version": "0.150.1",
-      "resolved": "https://registry.npmjs.org/three/-/three-0.150.1.tgz",
-      "integrity": "sha512-5C1MqKUWaHYo13BX0Q64qcdwImgnnjSOFgBscOzAo8MYCzEtqfQqorEKMcajnA3FHy1yVlIe9AmaMQ0OQracNA==",
+      "version": "0.178.0",
+      "resolved": "https://registry.npmjs.org/three/-/three-0.178.0.tgz",
+      "integrity": "sha512-ybFIB0+x8mz0wnZgSGy2MO/WCO6xZhQSZnmfytSPyNpM0sBafGRVhdaj+erYh5U+RhQOAg/eXqw5uVDiM2BjhQ==",
       "license": "MIT"
     },
     "node_modules/three-stdlib": {
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"PropertiesComponent\">{}</component>\r\n</project>
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 387f7fe72766336a5b3041ce9afc53a8e728d617)
+++ b/.idea/workspace.xml	(date 1752118493508)
@@ -1,4 +1,62 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
-  <component name="PropertiesComponent">{}</component>
+  <component name="AutoImportSettings">
+    <option name="autoReloadType" value="SELECTIVE" />
+  </component>
+  <component name="ChangeListManager">
+    <list default="true" id="5a3a7b6b-bf1d-4601-b41c-558c4a0842a4" name="Changes" comment="" />
+    <option name="SHOW_DIALOG" value="false" />
+    <option name="HIGHLIGHT_CONFLICTS" value="true" />
+    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
+    <option name="LAST_RESOLUTION" value="IGNORE" />
+  </component>
+  <component name="Git.Settings">
+    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
+  </component>
+  <component name="ProjectColorInfo"><![CDATA[{
+  "associatedIndex": 5
+}]]></component>
+  <component name="ProjectId" id="2zdwnu3HLFhPCpxHxnbmarxYXxz" />
+  <component name="ProjectViewState">
+    <option name="hideEmptyMiddlePackages" value="true" />
+    <option name="showLibraryContents" value="true" />
+  </component>
+  <component name="PropertiesComponent"><![CDATA[{
+  "keyToString": {
+    "RunOnceActivity.ShowReadmeOnStart": "true",
+    "RunOnceActivity.git.unshallow": "true",
+    "git-widget-placeholder": "main",
+    "ignore.virus.scanning.warn.message": "true",
+    "last_opened_file_path": "C:/projecthku/ai-health-frontend",
+    "node.js.detected.package.eslint": "true",
+    "node.js.detected.package.tslint": "true",
+    "node.js.selected.package.eslint": "(autodetect)",
+    "node.js.selected.package.tslint": "(autodetect)",
+    "nodejs_package_manager_path": "npm",
+    "ts.external.directory.path": "C:\\projecthku\\ai-health-frontend\\node_modules\\typescript\\lib",
+    "vue.rearranger.settings.migration": "true"
+  }
+}]]></component>
+  <component name="SharedIndexes">
+    <attachedChunks>
+      <set>
+        <option value="bundled-js-predefined-d6986cc7102b-1632447f56bf-JavaScript-WS-243.26053.12" />
+      </set>
+    </attachedChunks>
+  </component>
+  <component name="SpellCheckerSettings" RuntimeDictionaries="0" Folders="0" CustomDictionaries="0" DefaultDictionary="application-level" UseSingleDictionary="true" transferred="true" />
+  <component name="TaskManager">
+    <task active="true" id="Default" summary="Default task">
+      <changelist id="5a3a7b6b-bf1d-4601-b41c-558c4a0842a4" name="Changes" comment="" />
+      <created>1752074428248</created>
+      <option name="number" value="Default" />
+      <option name="presentableId" value="Default" />
+      <updated>1752074428248</updated>
+      <workItem from="1752074429989" duration="3046000" />
+    </task>
+    <servers />
+  </component>
+  <component name="TypeScriptGeneratedFilesManager">
+    <option name="version" value="3" />
+  </component>
 </project>
\ No newline at end of file
Index: src/components/Panda3D.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import React, { useRef, useEffect, useState } from 'react';\r\nimport * as THREE from 'three';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\r\n\r\ninterface Panda3DProps {\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\nconst Panda3D: React.FC<Panda3DProps> = ({\r\n  width = 400,\r\n  height = 450\r\n}) => {\r\n  const mountRef = useRef<HTMLDivElement>(null);\r\n  const sceneRef = useRef<THREE.Scene>();\r\n  const rendererRef = useRef<THREE.WebGLRenderer>();\r\n  const cameraRef = useRef<THREE.PerspectiveCamera>();\r\n  const modelRef = useRef<THREE.Group>();\r\n  const animationIdRef = useRef<number>();\r\n  const mixerRef = useRef<THREE.AnimationMixer>();\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [showSpeechBubble, setShowSpeechBubble] = useState(false);\r\n  const [showClickBubble, setShowClickBubble] = useState(false);\r\n  const [isClickAnimating, setIsClickAnimating] = useState(false);\r\n  const clickAnimationRef = useRef<number>(0);\r\n\r\n  // 拖拽相关状态\r\n  const isDraggingRef = useRef(false);\r\n  const lastMousePositionRef = useRef({ x: 0, y: 0 });\r\n  const initialMousePositionRef = useRef({ x: 0, y: 0 });\r\n  const modelRotationRef = useRef({ x: 0, y: -Math.PI / 2 });\r\n  const mouseHandlersRef = useRef<{\r\n    onMouseDown?: (event: MouseEvent) => void;\r\n    onMouseMove?: (event: MouseEvent) => void;\r\n    onMouseUp?: (event: MouseEvent) => void;\r\n  }>({});\r\n\r\n  \r\n\r\n\r\n  \r\n  const handleChickClick = () => {\r\n    setShowSpeechBubble(false);\r\n\r\n    setShowClickBubble(true);\r\n    setIsClickAnimating(true);\r\n    clickAnimationRef.current = 0;\r\n\r\n    setTimeout(() => {\r\n      setShowClickBubble(false);\r\n      setIsClickAnimating(false);\r\n    }, 2000);\r\n  };\r\n\r\n \r\n  useEffect(() => {\r\n    const handleMessageSent = () => {\r\n      setShowSpeechBubble(false);\r\n    };\r\n\r\n\r\n    window.addEventListener('messageSent', handleMessageSent);\r\n\r\n    return () => {\r\n      window.removeEventListener('messageSent', handleMessageSent);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!mountRef.current) return;\r\n\r\n    \r\n    const scene = new THREE.Scene();\r\n    scene.background = new THREE.Color(0xfbdde7); \r\n    sceneRef.current = scene;\r\n\r\n    \r\n    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);\r\n    camera.position.set(0, 0.2, 4.5);\r\n    camera.lookAt(0, -0.3, 0);\r\n    cameraRef.current = camera;\r\n\r\n    \r\n    const renderer = new THREE.WebGLRenderer({\r\n      antialias: true,\r\n      alpha: false, \r\n      powerPreference: \"high-performance\"\r\n    });\r\n    renderer.setSize(width, height);\r\n    renderer.setClearColor(0xc8c3e0, 1);\r\n    renderer.shadowMap.enabled = true;\r\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n    renderer.outputEncoding = THREE.sRGBEncoding;\r\n    renderer.toneMapping = THREE.ACESFilmicToneMapping;\r\n    renderer.toneMappingExposure = 1;\r\n    rendererRef.current = renderer;\r\n\r\n    if (mountRef.current) {\r\n      mountRef.current.appendChild(renderer.domElement);\r\n    }\r\n\r\n    \r\n    const loader = new GLTFLoader();\r\n    loader.load(\r\n      '/chick/scene.gltf',\r\n      (gltf) => {\r\n        const model = gltf.scene;\r\n        modelRef.current = model;\r\n\r\n\r\n        model.scale.setScalar(1.2);\r\n        model.position.set(0, -0.8, 0);\r\n        model.rotation.y = -Math.PI / 2;\r\n\r\n        // 直接显示说话框，不需要等待旋转完成\r\n        setTimeout(() => {\r\n          setShowSpeechBubble(true);\r\n        }, 500);\r\n\r\n       \r\n        model.traverse((child) => {\r\n          if (child instanceof THREE.Mesh) {\r\n            child.castShadow = true;\r\n            child.receiveShadow = true;\r\n\r\n           \r\n            if (child.material) {\r\n              child.material.needsUpdate = true;\r\n            }\r\n          }\r\n        });\r\n\r\n        scene.add(model);\r\n        setIsLoading(false);\r\n\r\n        \r\n        const raycaster = new THREE.Raycaster();\r\n        const mouse = new THREE.Vector2();\r\n\r\n        mouseHandlersRef.current.onMouseDown = (event: MouseEvent) => {\r\n          if (!mountRef.current || !cameraRef.current) return;\r\n\r\n          const rect = mountRef.current.getBoundingClientRect();\r\n          mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\r\n          mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\r\n\r\n          raycaster.setFromCamera(mouse, cameraRef.current);\r\n          const intersects = raycaster.intersectObject(model, true);\r\n\r\n          if (intersects.length > 0) {\r\n            isDraggingRef.current = true;\r\n            initialMousePositionRef.current = { x: event.clientX, y: event.clientY };\r\n            lastMousePositionRef.current = { x: event.clientX, y: event.clientY };\r\n            event.preventDefault();\r\n          }\r\n        };\r\n\r\n        mouseHandlersRef.current.onMouseMove = (event: MouseEvent) => {\r\n          if (!isDraggingRef.current || isClickAnimating) return;\r\n\r\n          const deltaX = event.clientX - lastMousePositionRef.current.x;\r\n          const deltaY = event.clientY - lastMousePositionRef.current.y;\r\n\r\n          const prev = modelRotationRef.current;\r\n          modelRotationRef.current = {\r\n            x: Math.max(-Math.PI / 2, Math.min(Math.PI / 2, prev.x + deltaY * 0.01)),\r\n            y: prev.y + deltaX * 0.01\r\n          };\r\n\r\n          lastMousePositionRef.current = { x: event.clientX, y: event.clientY };\r\n        };\r\n\r\n        mouseHandlersRef.current.onMouseUp = (event: MouseEvent) => {\r\n          if (isDraggingRef.current) {\r\n            // 计算从初始位置到释放位置的总距离\r\n            const deltaX = Math.abs(event.clientX - initialMousePositionRef.current.x);\r\n            const deltaY = Math.abs(event.clientY - initialMousePositionRef.current.y);\r\n            const totalDistance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n\r\n            // 如果鼠标移动距离很小，认为是点击\r\n            if (totalDistance < 10) {\r\n              handleChickClick();\r\n            }\r\n          }\r\n          isDraggingRef.current = false;\r\n        };\r\n\r\n        if (mountRef.current) {\r\n          mountRef.current.addEventListener('mousedown', mouseHandlersRef.current.onMouseDown);\r\n          // 将 mousemove 和 mouseup 事件添加到 document 上，这样即使鼠标移出容器也能继续拖拽\r\n          document.addEventListener('mousemove', mouseHandlersRef.current.onMouseMove);\r\n          document.addEventListener('mouseup', mouseHandlersRef.current.onMouseUp);\r\n        }\r\n\r\n        // 暂时移除动画，保持模型静止\r\n      },\r\n      () => {\r\n        // Loading progress\r\n      },\r\n      (error) => {\r\n        console.error('Error loading model:', error);\r\n        setIsLoading(false);\r\n      }\r\n    );\r\n\r\n    \r\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);\r\n    scene.add(ambientLight);\r\n\r\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\r\n    directionalLight.position.set(5, 10, 5);\r\n    directionalLight.castShadow = true;\r\n    directionalLight.shadow.mapSize.width = 2048;\r\n    directionalLight.shadow.mapSize.height = 2048;\r\n    scene.add(directionalLight);\r\n\r\n    const pointLight = new THREE.PointLight(0xffffff, 0.5, 100);\r\n    pointLight.position.set(0, 5, 10);\r\n    scene.add(pointLight);\r\n\r\n    // 渲染循环（无动画）\r\n    const animate = () => {\r\n      animationIdRef.current = requestAnimationFrame(animate);\r\n\r\n      if (modelRef.current) {\r\n        if (!isClickAnimating) {\r\n          // 应用拖拽旋转\r\n          modelRef.current.rotation.x = modelRotationRef.current.x;\r\n          modelRef.current.rotation.y = modelRotationRef.current.y;\r\n        }\r\n\r\n        if (isClickAnimating) {\r\n          clickAnimationRef.current += 0.15;\r\n          const bounce = Math.sin(clickAnimationRef.current * 2) * 0.3;\r\n          const wiggle = Math.sin(clickAnimationRef.current * 8) * 0.2;\r\n          const scale = 1.2 + Math.sin(clickAnimationRef.current * 4) * 0.15;\r\n\r\n          modelRef.current.position.y = -0.8 + Math.abs(bounce);\r\n          modelRef.current.rotation.z = wiggle;\r\n          modelRef.current.scale.setScalar(scale);\r\n\r\n          if (clickAnimationRef.current >= Math.PI * 3) {\r\n            setIsClickAnimating(false);\r\n            modelRef.current.position.y = -0.8;\r\n            modelRef.current.rotation.z = 0;\r\n            modelRef.current.scale.setScalar(1.2);\r\n            clickAnimationRef.current = 0;\r\n          }\r\n        }\r\n      }\r\n\r\n      renderer.render(scene, camera);\r\n    };\r\n\r\n    animate();\r\n\r\n    // 清理函数\r\n    return () => {\r\n      if (animationIdRef.current) {\r\n        cancelAnimationFrame(animationIdRef.current);\r\n      }\r\n      if (mixerRef.current) {\r\n        mixerRef.current.stopAllAction();\r\n      }\r\n      if (mountRef.current) {\r\n        // 移除事件监听器\r\n        if (mouseHandlersRef.current.onMouseDown) {\r\n          mountRef.current.removeEventListener('mousedown', mouseHandlersRef.current.onMouseDown);\r\n          document.removeEventListener('mousemove', mouseHandlersRef.current.onMouseMove!);\r\n          document.removeEventListener('mouseup', mouseHandlersRef.current.onMouseUp!);\r\n        }\r\n\r\n        if (renderer.domElement && mountRef.current.contains(renderer.domElement)) {\r\n          try {\r\n            mountRef.current.removeChild(renderer.domElement);\r\n          } catch (error) {\r\n            console.warn('Failed to remove renderer DOM element:', error);\r\n          }\r\n        }\r\n      }\r\n      renderer.dispose();\r\n    };\r\n  }, [width, height]);\r\n\r\n  return (\r\n    <>\r\n      <style>\r\n        {`\r\n          @keyframes fadeInUp {\r\n            from {\r\n              opacity: 0;\r\n              transform: translateY(10px);\r\n            }\r\n            to {\r\n              opacity: 1;\r\n              transform: translateY(0);\r\n            }\r\n          }\r\n        `}\r\n      </style>\r\n      <div\r\n        style={{\r\n          width: `${width}px`,\r\n          height: `${height}px`,\r\n          margin: '0 auto',\r\n          borderRadius: '20px',\r\n          overflow: 'hidden',\r\n          position: 'relative'\r\n        }}\r\n      >\r\n      <div\r\n        ref={mountRef}\r\n        style={{\r\n          width: '100%',\r\n          height: '100%'\r\n        }}\r\n      />\r\n      {isLoading && (\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            top: '50%',\r\n            left: '50%',\r\n            transform: 'translate(-50%, -50%)',\r\n            color: 'white',\r\n            fontSize: '16px',\r\n            fontWeight: 'bold',\r\n            textShadow: '0 2px 4px rgba(0,0,0,0.5)'\r\n          }}\r\n        >\r\n          Loading 3D Model...\r\n        </div>\r\n      )}\r\n\r\n      {/* 说话框 */}\r\n      {showSpeechBubble && (\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            top: '20px',\r\n            left: '20px',\r\n            backgroundColor: 'white',\r\n            padding: '12px 16px',\r\n            borderRadius: '20px',\r\n            boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n            fontSize: '14px',\r\n            color: '#333',\r\n            maxWidth: '200px',\r\n            fontFamily: 'Arial, sans-serif',\r\n            lineHeight: '1.4',\r\n            border: '2px solid #c8c3e0',\r\n            animation: 'fadeInUp 0.5s ease-out'\r\n          }}\r\n        >\r\n          Hi! I'm Nikky. How are you feeling today?\r\n          {}\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: '-8px',\r\n              left: '30px',\r\n              width: '0',\r\n              height: '0',\r\n              borderLeft: '8px solid transparent',\r\n              borderRight: '8px solid transparent',\r\n              borderTop: '8px solid white'\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: '-10px',\r\n              left: '28px',\r\n              width: '0',\r\n              height: '0',\r\n              borderLeft: '10px solid transparent',\r\n              borderRight: '10px solid transparent',\r\n              borderTop: '10px solid #c8c3e0'\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {showClickBubble && !showSpeechBubble && (\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            top: '20px',\r\n            right: '20px',\r\n            backgroundColor: 'white',\r\n            padding: '12px 16px',\r\n            borderRadius: '20px',\r\n            boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n            fontSize: '14px',\r\n            color: '#333',\r\n            maxWidth: '200px',\r\n            fontFamily: 'Arial, sans-serif',\r\n            lineHeight: '1.4',\r\n            border: '2px solid #c8c3e0',\r\n            animation: 'fadeInUp 0.5s ease-out'\r\n          }}\r\n        >\r\n          waves wing~ Hello friend!\r\n          {/* 说话框尾巴 */}\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: '-8px',\r\n              right: '30px',\r\n              width: '0',\r\n              height: '0',\r\n              borderLeft: '8px solid transparent',\r\n              borderRight: '8px solid transparent',\r\n              borderTop: '8px solid white'\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: '-10px',\r\n              right: '28px',\r\n              width: '0',\r\n              height: '0',\r\n              borderLeft: '10px solid transparent',\r\n              borderRight: '10px solid transparent',\r\n              borderTop: '10px solid #c8c3e0'\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Panda3D;\r\n
===================================================================
diff --git a/src/components/Panda3D.tsx b/src/components/Panda3D.tsx
--- a/src/components/Panda3D.tsx	(revision 387f7fe72766336a5b3041ce9afc53a8e728d617)
+++ b/src/components/Panda3D.tsx	(date 1752077239260)
@@ -88,9 +88,16 @@
     });
     renderer.setSize(width, height);
     renderer.setClearColor(0xc8c3e0, 1);
+    // renderer.shadowMap.enabled = true;
+    // renderer.shadowMap.type = THREE.PCFSoftShadowMap;
+    // renderer.outputEncoding = THREE.sRGBEncoding;
+    // renderer.toneMapping = THREE.ACESFilmicToneMapping;
+    // renderer.toneMappingExposure = 1;
+    // rendererRef.current = renderer;
+
     renderer.shadowMap.enabled = true;
     renderer.shadowMap.type = THREE.PCFSoftShadowMap;
-    renderer.outputEncoding = THREE.sRGBEncoding;
+    renderer.outputColorSpace = THREE.SRGBColorSpace;
     renderer.toneMapping = THREE.ACESFilmicToneMapping;
     renderer.toneMappingExposure = 1;
     rendererRef.current = renderer;
